--[[
排兵布阵脚本000150 - 纵向梯形编队
用途：创建一个从前到后逐渐拉开距离的纵向梯形阵型
适用场景：走廊、通道等狭窄空间的多敌人协同作战
战术特点：前锋带头冲锋，后续梯次跟进，保持压迫感的同时避免相互碰撞

编队结构：
成员0：前锋 (0, 0) - 位于编队最前方，负责主要攻击
成员1：第一梯队 (0, 1.5) - 紧随前锋，提供火力支援
成员2：第二梯队 (0, -1.5) - 与第一梯队平行，形成包围态势
成员3：第三梯队 (0, -4.5) - 保持距离，准备补位或远程支援
成员4：第四梯队 (0, -7.5) - 后备力量，负责侧翼保护
成员5：后卫 (0, -10.5) - 编队最后方，负责断后和远程攻击

移动速率：前锋1.5倍速度，确保能够快速接敌
--]]
function Platoon000150_Activate(f1_arg0)
    -- 启用排兵布阵移动模式
    f1_arg0:SetEnablePlatoonMove(true)

    -- 设置编队类型为纵向编队 (参数: 编队ID=0, 类型=2)
    -- 类型2表示纵向线性排列，适合狭窄空间作战
    f1_arg0:SetFormationType(0, 2)

    -- 设置各成员的相对位置参数 (成员索引, X偏移, Y偏移)
    -- 前锋位置 - 编队核心，负责主攻
    f1_arg0:SetFormationParam(0, 0, 0)

    -- 第一梯队 - 前锋后方1.5单位，快速跟进
    f1_arg0:SetFormationParam(1, 0, 1.5)

    -- 第二梯队 - 与第一梯队错开，形成交叉火力
    f1_arg0:SetFormationParam(2, 0, -1.5)

    -- 第三梯队 - 中距离支援位置
    f1_arg0:SetFormationParam(3, 0, -4.5)

    -- 第四梯队 - 远距离支援，保持战术纵深
    f1_arg0:SetFormationParam(4, 0, -7.5)

    -- 后卫 - 最远距离，负责断后和控制
    f1_arg0:SetFormationParam(5, 0, -10.5)

    -- 设置前锋的移动速率为1.5倍，确保能够率先接敌
    -- 这样可以让前锋快速突进，后续部队梯次跟进
    f1_arg0:SetBaseMoveRate(0, 1.5)

end

--[[
排兵布阵停用函数
功能：当编队解散时执行的清理操作
参数：f2_arg0 - 排兵布阵对象
说明：当前版本为空实现，可根据需要添加特定的清理逻辑
--]]
function Platoon000150_Deactivate(f2_arg0)
    -- 目前无特殊清理操作
    -- 可在此处添加编队解散时的特殊处理，如：
    -- - 重置成员状态
    -- - 清除编队标记
    -- - 恢复个体AI行为
end

--[[
排兵布阵更新函数 - 主要逻辑控制
功能：每帧更新编队状态，处理编队移动和解散条件
参数：f3_arg0 - 排兵布阵对象
执行频率：每游戏帧调用一次

逻辑流程：
1. 检查前锋(成员0)的移动点状态
2. 如果前锋无可用移动点(-1)，则解散编队
3. 否则执行通用编队行为

适用条件：
- 前锋存在且有效
- 编队处于激活状态
- 目标区域可达
--]]
function Platoon000150_Update(f3_arg0)
    -- 获取编队前锋(索引0)的AI对象
    -- 前锋是编队的核心，其状态决定整个编队的行为
    local f3_local0 = f3_arg0:GetMemberAI(0)

    -- 检查前锋的移动点状态
    -- GetMovePointNumber() == -1 表示无有效移动目标点
    if f3_local0:GetMovePointNumber() == -1 then
        -- 前锋无目标时，解散编队，切换为个体行为模式
        f3_arg0:SetEnablePlatoonMove(false)

        -- 向所有编队成员发送解散命令
        -- 从后往前遍历，避免索引变化导致的问题
        for f3_local1 = f3_arg0:GetMemberNum() - 1, 0, -1 do
            -- 发送命令0（通常表示解散/自由行动）
            f3_arg0:SendCommand(f3_local1, 0)
        end
    else
        -- 前锋有有效目标时，执行标准编队行为
        -- 调用通用编队处理函数，处理移动、攻击、协调等
        Platoon_Common_Act(f3_arg0)
    end

end


